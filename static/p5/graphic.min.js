let ratio,diagonalDist,speed,lineWidth=25,movers=[];function setup(){createCanvas(innerWidth,innerHeight),colorMode(HSB),valueSetting(),setTimeout(function(){let t=1+floor(9*getRatio()),i=360/t;for(let e=0;e<t;e++)movers.push(new Mover(new p5.Vector(width/2,height/2),random(70,150),color(i*e,100,100)));movers.sort(function(t,i){return t.altitude-i.altitude})},1500)}function windowResized(){resizingCanvas()}function resizingCanvas(){resizeCanvas(innerWidth,innerHeight),valueSetting()}function draw(){innerWidth==width&&innerHeight==height||resizingCanvas(),clear();for(let t of movers)t.update(),t.drawShadow();for(let t of movers)t.drawBody()}function getRatio(t=!1){const i=Math.sqrt(width*height/144e4);return"max"==t?i>1?1:i:"min"==t?i>1?i:1:i}function valueSetting(){ratio=getRatio("min"),speed=1.5*ratio,diagonalDist=dist(0,0,width,height)}class Mover{constructor(t,i,e){this.pos=t,this.tailLength=i,this.color=e,this.theta=random(TWO_PI),this.dir=random(-1,1),this.dir/=abs(this.dir),this.altitude=random(),this.parts=[],this.parts.push(new Part(this.theta,this.pos,this.dir)),this.theta+=PI}update(){this.lineWidth=25*ratio;let t=ratio*this.tailLength,i=this.parts[this.parts.length-1];i.lastTheta=this.theta,i.cumulativeAngle>i.targetAngle&&this.isInsideCheck()&&(this.parts.push(new Part(this.theta,this.pos,i.dir)),this.theta+=PI,(i=this.parts[this.parts.length-1]).lastTheta=this.theta);let e=speed/i.radius*PI;this.theta+=e*i.dir,i.cumulativeAngle+=e;let s=0;for(let t=0;t<this.parts.length;t++){let i=this.parts[t];s+=i.cumulativeAngle*i.radius}if(s>t){let i=s-t;for(let t=0;t<this.parts.length;t++){let e=this.parts[t],s=abs(i/(e.radius*TWO_PI)*TWO_PI);if(e.cumulativeAngle>=s?(t==this.parts.length-1&&(e.targetAngle-=s),e.cumulativeAngle-=s,e.startTheta=e.startTheta+s*e.dir,i=0):(i=(s-e.cumulativeAngle)*e.radius,e.isDie=!0),i=0)break}}this.parts=this.parts.filter(t=>!t.isDie);let a=new p5.Vector(i.radius,0);a.rotate(this.theta),a.add(i.anchor),this.pos=a}drawShadow(){stroke("rgba(0,0,0,0.75)"),this.drawShape()}drawBody(){stroke(this.color),push(),translate(-1.5*ratio+-1.5*this.altitude,-22.5*ratio+-22.5*this.altitude),this.drawShape(),pop()}drawShape(){strokeWeight(this.lineWidth),noFill(),beginShape();const t=PI;for(let i=0;i<this.parts.length;i++){let e=this.parts[i],s=ceil(e.cumulativeAngle/t),a=e.cumulativeAngle,r=e.startTheta;for(let i=0;i<s;i++){let i=getBezierArcPoints(e.anchor,e.radius,r,(a>t?t:a)*e.dir);vertex(i[0].x,i[0].y),bezierVertex(i[1].x,i[1].y,i[2].x,i[2].y,i[3].x,i[3].y),r+=t*e.dir,a-=t}}endShape()}guideline(){noFill(),stroke(this.color),strokeWeight(1),ellipse(this.anchor.x,this.anchor.y,2*this.radius),strokeWeight(5),point(this.anchor.x,this.anchor.y)}isInsideCheck(){return!(this.pos.x<-this.lineWidth/2||this.pos.x>width+this.lineWidth/2||this.pos.y<-this.lineWidth/2||this.pos.y>height+this.lineWidth/2)}}class Part{constructor(t,i,e){this.radius=random(lineWidth/2*ratio,(ratio>1?459:diagonalDist/4)*ratio),this.cumulativeAngle=0,this.targetAngle=random(QUARTER_PI,PI),this.startTheta=(t+PI)%(2*PI);let s=new p5.Vector(this.radius,0);s.rotate(t),this.anchor=s.add(i),this.dir=-1*e}}function getBezierArcPoints(t,i,e,s){let a=new p5.Vector(i,0);a.rotate(e);let r=a.copy();r.rotate(s);let h=4/3*tan(s/4),n=new p5.Vector(h*i,0);n.rotate(e+HALF_PI);let o=new p5.Vector(h*i,0);return o.rotate(e+s-HALF_PI),a.add(t),r.add(t),n.add(a),o.add(r),[a,n,o,r]}